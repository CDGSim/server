<!DOCTYPE html><html><head><meta charset="UTF-8"/><meta name="og:site_name" content="Documentation Logs de Simulations"/><link rel="canonical" href="https://your-website-url.com/serveur"/><meta name="twitter:url" content="https://your-website-url.com/serveur"/><meta name="og:url" content="https://your-website-url.com/serveur"/><title>Serveur | Documentation Logs de Simulations</title><meta name="twitter:title" content="Serveur | Documentation Logs de Simulations"/><meta name="og:title" content="Serveur | Documentation Logs de Simulations"/><meta name="description" content="Documentation du système de logs de simulations"/><meta name="twitter:description" content="Documentation du système de logs de simulations"/><meta name="og:description" content="Documentation du système de logs de simulations"/><meta name="twitter:card" content="summary"/><link rel="stylesheet" href="/styles.css" type="text/css"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="shortcut icon" href="/images/favicon.png" type="image/png"/><link rel="alternate" href="/feed.rss" type="application/rss+xml" title="Subscribe to Documentation Logs de Simulations"/></head><body><div class="content"><div class="row"><div class="nav-container"><div><ul class="item-list"><li><a href="/introduction">Introduction</a><ul class="item-list"></ul></li><li><a class="selected" href="/serveur">Serveur</a><ul class="item-list"></ul></li><li><a href="/editeur">Éditeur</a><ul class="item-list"></ul></li></ul></div></div><div class="nav-content"><h1>Serveur</h1><img src="/assets/Serveur.svg" alt="Serveur" width="260"/><p>Le serveur est une application écrite en Swift, qui peut être executée sur un système macOS ou Linux Ubuntu. Elle utilise le framework <a href="https://vapor.codes">Vapor</a>. Le code source du serveur est hébergé sur <a href="https://github.com/CDGSim/server">GitHub</a>.</p><p>Les machines de production sont des Raspberry-Pi tournant sous Ubuntu, avec Docker installé. Le serveur est exécuté dans un conteneur Docker. Ceci permet d'exécuter le serveur dans un environnement qui sera toujours identique, quelle que soit la machine hôte (Raspberry Pi, Mac ou PC). Docker permet également de relancer automatiquement une instance si l'application crashe.</p><h2>Installation</h2><p>Récupérez le code source en entrant la commande suivante :</p><pre><code>git clone https://github.com/CDGSim/server.git
</code></pre><p>Ceci crée un répertoire <code>server</code> contenant le code source du serveur web.</p><pre><code>cd server
</code></pre><h2>Déploiement</h2><p>L'application est exécutée dans une instance Docker.</p><p><strong>Pour builder une image Docker pour Raspberry-Pi</strong>, entrez la commande suivante. Elle spécifie un fichier Dockerfile pour Raspberry Pi, et ajoute un tag à l'image crée :</p><pre><code>docker build -f Dockerfile-pi -t log-server .
</code></pre><p>Une fois l'image buildée, vous pouvez éxecuter une instance de l'image dans un conteneur Docker.</p><p>Il faut se placer dans le dossier parent du dossier contenant les logs :</p><pre><code>cd ..
</code></pre><p>La commande suivante lance un conteneur correspondant à l'image <code>log-server</code> avec les paramètres suivants :</p><pre><code>docker run
    -d
    -p 80:8080
    --restart unless-stopped
    --mount type=bind,source="$(pwd)"/Logs,target=/app/Public/logs
    log-server
</code></pre><ul><li><code>-d</code> mode deamon</li><li><code>-p 80:8080</code> mappe le port 80 de la machine hôte au port 8080 du container</li><li><code>--restart unless-stopped</code> permet de redémarrer le container automatiquement en cas de crash</li><li><code>--mount type=bind,source ="$(pwd)"/Logs,target=/app/Public/logs</code> permet de lier le dossier Logs du répertoire courrant au dossier du container contenant les logs</li></ul><p>En salle ELECTRA, pour afficher les liens vers la configuration de DECOR, il faut passer un argument additionnel :</p><p><code> -e simulator=electra </code> pour passer la valeur electra comme valeur pour la variable d'environnement simulator</p></div></div></div></body></html>